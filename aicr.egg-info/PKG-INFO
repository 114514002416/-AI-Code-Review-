Metadata-Version: 2.4
Name: aicr
Version: 0.1.0
Summary: Open-source AI Code Review CLI and GitHub Action
Author: Open-Source Contributors
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: requests>=2.31.0
Requires-Dist: PyYAML>=6.0.1

# AICR — 开源 AI Code Review

AICR 是一个开源的代码审查工具：在本地作为 CLI 使用，或在 GitHub 中作为 Composite Action 运行。它包含可用的静态启发式检查，并可选接入 LLM（OpenAI 兼容/本地 Ollama）产生更高质量的建议。

## 功能特性
- 启发式检查：TODO/FIXME、`eval/exec`、`subprocess(..., shell=True)`、不安全 `pickle` 反序列化、疑似密钥、过长函数块等
- Git diff 感知：优先关注新增行
- 可选 LLM 总结：OpenAI 兼容 API 或 Ollama（通过 `base-url` 指定）
- GitHub Action：对 PR 自动发表评论（单条汇总，避免过度刷屏）

## 本地快速开始（CLI）

```bash
# 安装（开发目录）
pip install -e .

# 对当前变更执行审查（自动检测 git diff）
aicr

# 指定路径执行审查
aicr src/ tests/

# 启用 LLM 建议（需要 API 配置）
export OPENAI_API_KEY=sk-...
aicr --use-llm --model gpt-4o-mini --base-url https://api.openai.com/v1
```

## GitHub Action 使用

1. 将本仓库作为 Action（或直接复用本仓库）。
2. 在你的仓库添加工作流文件 `.github/workflows/aicr.yml`：

```yaml
name: AI Code Review
on:
	pull_request:
		types: [opened, synchronize, reopened]

jobs:
	review:
		runs-on: ubuntu-latest
		steps:
			- uses: actions/checkout@v4
			- uses: 你的组织/你的仓库@main # 或者 uses: ./（如果放在同仓库根目录）
				with:
					github-token: ${{ secrets.GITHUB_TOKEN }}
					use-llm: false
					max-comments: 50
					# model: gpt-4o-mini
					# base-url: https://api.openai.com/v1
```

Action 输入参数：
- `github-token`（可选）：默认使用 `GITHUB_TOKEN`
- `use-llm`（可选）：`true/false` 是否启用 LLM
- `model`（可选）：LLM 模型名称
- `base-url`（可选）：OpenAI 兼容 API 或 Ollama 的 base URL，例如 `http://localhost:11434/v1`
- `max-comments`（可选）：最多输出的启发式问题数（默认 50）

如果启用 LLM，请在仓库 Secrets 配置：
- `OPENAI_API_KEY` 或 `AICR_API_KEY`

## 设计与范围
- 先以启发式保证“即装即用”，LLM 作为可选增强
- 暂以单条 PR 评论汇总，后续可扩展成逐文件/逐行注释
- 不与语言特定 Linter 冲突，更多是补全维度（安全、密钥、复杂度）

## 常见问题
- 无法定位变更？本地 CLI 默认选择 `merge-base` 与 `HEAD` 间的 diff，或使用 `--rev origin/main...HEAD` 指定范围。
- 无法调用 LLM？确认 `OPENAI_API_KEY`（或 `AICR_API_KEY`）和 `--base-url`（若非官方）是否设置正确。

## 开发

```bash
pip install -e .
aicr --help
```

欢迎提 Issue / PR 共同改进。
